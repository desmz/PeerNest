notation crows-foot
colorMode pastel
styleMode plain
typeface rough

role [color: blue] {
  role_id varchar pk
  role_name varchar
  role_rank int
  role_created_time timestamptz
  role_updated_time timestamptz?
  role_deleted_time timestamptz?

  // unique(name)
}

user [color: blue] {
  user_id varchar pk
  user_display_name varchar
  user_display_name_tsv tsvector
  user_password_hash varchar?
  user_role_id varchar fk
  user_email varchar
  user_avatar_url text
  user_created_time timestamptz
  user_updated_time timestamptz?
  user_deleted_time timestamptz?
  user_last_signed_time timestamptz

  // unique(email)
}

role.id < user.role_id

account [color: blue] {
  account_id varchar pk
  account_user_id varchar fk
  account_type varchar // social, local
  account_provider varchar // google, password
  account_provider_user_id varchar
  account_created_time timestamptz
  account_updated_time timestamptz?
  account_deleted_time timestamptz?

  // unique(provider, provider_user_id)
}

user.id < account.user_id

attachment [color:blue] {
  attachment_id varchar pk
  attachment_owner_id varchar?
  attachment_path text
  attachment_name varchar
  attachment_size int
  attachment_mimetype varchar
  attachment_width int?
  attachment_height int?
  attachment_created_time timestamptz
  attachment_updated_time timestamptz?
  attachment_deleted_time timestamptz?
}

user_token [color: blue] {
  user_token_id varchar pk
  user_token_user_id varchar fk
  user_token_type varchar
  user_token_token_hash varchar
  user_token_created_time timestamptz
  user_token_expired_time timestamptz
  user_token_used_time timestamptz?
}

user.id < user_token.user_id

pronoun [color: blue] {
  pronoun_id varchar pk
  pronoun_name varchar
  pronoun_created_time timestamptz
  pronoun_updated_time timestamptz?
  pronoun_deleted_time timestamptz?
}


university [color: blue] {
  university_id varchar pk
  university_name varchar
  university_country varchar
  university_created_time timestamptz
  university_updated_time timestamptz?
  university_deleted_time timestamptz?
}

university.id - user_info.university_id

domain [color: blue] {
  domain_id varchar pk
  domain_name varchar
  domain_created_time timestamptz
  domain_updated_time timestamptz?
  domain_deleted_time timestamptz?
}

domain.id - user_info.domain_id

user_info [color: blue] {
  user_info_id varchar pk
  user_info_user_id varchar fk
  user_info_pronoun_id varchar? fk
  user_info_university_id varchar? fk
  user_info_domain_id varchar? fk
  user_info_bio text?
  user_info_looking_for text?
  user_info_created_time timestamptz
  user_info_updated_time timestamptz?
  user_info_deleted_time timestamptz?
}

user.id - user_info.user_id
pronoun.id - user_info.pronoun_id

interest [color: blue] {
  interest_id varchar pk
  interest_name varchar
  interest_position numeric // numeric(20, 10)
  interest_created_time timestamptz
  interest_updated_time timestamptz?
  interest_deleted_time timestamptz?
}

personal_goal [color: blue] {
  personal_goal_id varchar pk
  personal_goal_title varchar
  personal_goal_name varchar
  personal_goal_description text?
  personal_goal_position numeric // numeric(20, 10)
  personal_goal_created_time timestamptz
  personal_goal_updated_time timestamptz?
  personal_goal_deleted_time timestamptz?
}

user_info_interest [color: green] {
  user_info_interest_id varchar pk
  user_info_interest_user_info_id varchar fk
  user_info_interest_interest_id varchar fk
  user_info_interest_position numeric // numeric(20, 10)
  user_info_interest_created_time timestamptz
  user_info_interest_updated_time timestamptz?

  // unique(user_info_id, interest_id)
}

user_info.id < user_info_interest.user_info_id
interest.id < user_info_interest.interest_id

user_info_personal_goal [color: green] {
  user_info_personal_goal_id varchar pk
  user_info_personal_goal_user_info_id varchar fk
  user_info_personal_goal_personal_goal_id varchar fk
  user_info_personal_goal_position numeric // numeric(20, 10)
  user_info_personal_goal_created_time timestamptz
  user_info_personal_goal_updated_time timestamptz?

  // unique(user_info_id, personal_goal_id)
}

user_info.id < user_info_personal_goal.user_info_id
personal_goal.id < user_info_personal_goal.personal_goal_id

discussion [color: blue] {
  discussion_id varchar pk
  discussion_author_id varchar fk
  discussion_title varchar
  discussion_content text
  discussion_search_tsv tsvector
  discussion_status varchar // active, archived, deleted
  discussion_created_time timestamptz
  discussion_updated_time timestamptz?
  discussion_archived_time timestamptz?
  discussion_archived_by varchar? fk
  discussion_deleted_time timestamptz?

  // to_tsvector(title, content)
}

user.id < discussion.author_id
user.id < discussion.archived_by

discussion_attachment [color: green] {
  discussion_attachment_id varchar pk
  discussion_attachment_discussion_id varchar fk
  discussion_attachment_attachment_id varchar fk

  // unique(discussion, attachment_id)
}

discussion.id < discussion_attachment.discussion_id
attachment.id < discussion_attachment.attachment_id

discussion_personal_goal [color: green] {
  discussion_personal_goal_id varchar pk
  discussion_personal_goal_discussion_id varchar fk
  discussion_personal_goal_personal_goal_id varchar fk
  discussion_personal_goal_position numeric // numeric(20, 10)

  // unique(discussion_id, personal_goal_id)
}

discussion.id < discussion_personal_goal.discussion_id
personal_goal.id < discussion_personal_goal.personal_goal_id

discussion_interest [color: green] {
  discussion_interest_id varchar pk
  discussion_interest_discussion_id varchar fk
  discussion_interest_interest_id varchar fk
  discussion_interest_position numeric // numeric(20, 10)

  // unique(discussion_id, interest_id)
}

discussion.id < discussion_interest.discussion_id
interest.id < discussion_interest.interest_id

user_discussion_report [color: green] {
  user_discussion_report_id varchar pk
  user_discussion_report_reporter_id varchar fk
  user_discussion_report_discussion_id varchar fk
  user_discussion_report_status varchar // reported, deleted, released 
  user_discussion_report_reported_time timestamptz
  user_discussion_report_resolver_id varchar? fk
  user_discussion_report_resolved_time timestamptz?

  // unique(reporter_id, discussion_id)
}

user.id < user_discussion_report.reporter_id
discussion.id < user_discussion_report.discussion_id
user.id < user_discussion_report.resolver_id

comment [color: blue] {
  comment_id varchar pk
  comment_author_id varchar fk
  comment_discussion_id varchar fk
  comment_parent_comment_id varchar? fk
  comment_content text 
  comment_created_time timestamptz
  comment_updated_time timestamptz?
  comment_deleted_time timestamptz?

  // index(author_id, discussion_id)
}

user.id < comment.author_id
discussion.id < comment.discussion_id
comment.parent_comment_id < comment.id
 
user_comment_report [color: green] {
  user_comment_report_id varchar pk
  user_comment_report_comment_id varchar fk
  user_comment_report_reporter_id varchar fk
  user_comment_report_status varchar // reported, deleted, released 
  user_comment_report_reported_time timestamptz
  user_comment_report_resolver_id varchar? fk
  user_comment_report_resolved_time timestamptz?

  // unique(reporter_id, discussion_id)
}

user.id < user_comment_report.reporter_id
comment.id < user_comment_report.comment_id
user.id < user_comment_report.resolver_id

user_discussion_like [color: green] {
  user_discussion_like_id varchar pk
  user_discussion_like_user_id varchar fk
  user_discussion_like_discussion_id varchar fk
  user_discussion_like_created_time timestamptz

  // unique(user_id, discussion_id)
}

user.id < user_discussion_like.user_id
discussion.id < user_discussion_like.discussion_id

user_comment_like [color: green] {
  user_comment_like_id varchar pk
  user_comment_like_user_id varchar fk
  user_comment_like_comment_id varchar fk
  user_comment_like_created_time timestamptz

  // unique(user_id, comment_id)
}

user.id < user_comment_like.user_id
comment.id < user_comment_like.comment_id

ban_request [color: blue] {
  ban_request_id varchar pk
  ban_request_requester_id varchar fk
  ban_request_banned_user_id varchar fk
  ban_request_status varchar // pending, approved, rejected
  ban_request_reasons text
  ban_request_proof_reference_raw text
  ban_request_created_time timestamptz
  ban_request_resolver_id varchar? fk
  ban_request_resolved_time timestamptz?

  // check(requester_id != banned_user_id)
  // check(requester_id != resolver_id)
}

user.id < ban_request.requester_id
user.id < ban_request.banned_user_id
user.id < ban_request.resolver_id

ban_request_proof [color: blue] {
  ban_request_proof_id varchar pk
  ban_request_proof_ban_request_id varchar fk
  ban_request_proof_resource_id varchar
  ban_request_proof_resource_type varchar // discussion, comment 
  ban_request_proof_reference_raw text
}

ban_request.id < ban_request_proof.ban_request_id

ban_action [color: blue] {
  ban_action_id varchar pk
  ban_action_banned_user_id varchar fk
  ban_action_ban_request_id varchar? fk
  ban_action_banned_by varchar fk
  ban_action_reason text
  ban_action_created_time timestamptz
  ban_action_updated_time timestamptz?
  ban_action_ban_start_time timestamptz
  ban_action_ban_end_time timestamptz?

  // check(banned_user_id != banned_by)
}

user.id < ban_action.ban_user_id
ban_request.id < ban_action.ban_request_id
user.id < ban_action.banned_by

friend_request [color: blue] {
  friend_request_id varchar pk
  friend_request_from_id varchar fk
  friend_request_to_id varchar fk
  friend_request_status varchar // pending, accepted, rejected
  friend_request_matched_by_system boolean
  friend_request_created_time timestamptz
  friend_request_resolved_time timestamptz?

  // unique(from_id, to_id)
  // check(from_id != to_id)
}

user.id < friend_request.from_id
user.id < friend_request.to_id

relationship [color: green] {
  relationship_id varchar pk
  relationship_user_id_a varchar fk
  relationship_user_id_b varchar fk
  relationship_type varchar // friend
  relationship_created_time timestamptz

  // unique(user_id_a, user_id_b)
  // check(user_id_a < user_id_b)
}

user.id < relationship.user_id_a
user.id < relationship.user_id_b

conversation [color: blue] {
  conversation_id varchar pk
  conversation_type varchar // direct
  conversation_created_time timestamptz
  conversation_updated_time timestamptz?
}

message [color: blue] {
  message_id varchar pk
  message_author_id varchar fk
  message_content text
  message_content_tsv tsvector
  message_created_time timestamptz
  message_updated_time timestamptz?
  message_deleted_time timestamptz?
}

user.id < message.author_id

message_attachment [color: green] {
  message_attachment_id varchar pk
  message_attachment_message_id varchar fk
  message_attachment_attachment_id varchar fk

  // unique(message_id, attachment_id)
}

message.id < message_attachment.message_id
attachment.id < message_attachment.attachment_id

conversation_participant [color: green] {
  conversation_participant_id varchar pk
  conversation_participant_conversation_id varchar fk
  conversation_participant_participant_id varchar fk
  conversation_participant_role varchar // member, mod, admin, counselor
  conversation_participant_last_read_message_id varchar? fk
  conversation_participant_joined_time timestamptz

  // unique(conversation_id, participant_id)
}

conversation.id < conversation_participant.conversation_id
user.id < conversation_participant.participant_id
message.id < conversation_participant.last_read_message_id

wellness_mood [color: blue] {
  wellness_mood_id varchar pk
  wellness_mood_name varchar
  wellness_mood_position numeric // numeric(20, 10)
  wellness_mood_created_time timestamptz
  wellness_mood_updated_time timestamptz?
  wellness_mood_deleted_time timestamptz?

  // unique(name)
}

wellness_symptom_category [color: blue] {
  wellness_symptom_category_id varchar pk
  wellness_symptom_category_name varchar
  wellness_symptom_category_position numeric // numeric(20, 10)
  wellness_symptom_category_created_time timestamptz
  wellness_symptom_category_updated_time timestamptz?
  wellness_symptom_category_deleted_time timestamptz?

  // unique(name)
}

wellness_symptom [color: blue] {
  wellness_symptom_id varchar pk
  wellness_symptom_name varchar
  wellness_symptom_wellness_symptom_category_id varchar fk
  wellness_symptom_position numeric // numeric(20, 10)
  wellness_symptom_created_time timestamptz
  wellness_symptom_updated_time timestamptz?
  wellness_symptom_deleted_time timestamptz?

  // unique(name)
}

wellness_symptom_category.id < wellness_symptom.wellness_symptom_category_id

wellness_factor_category [color: blue] {
  wellness_factor_category_id varchar pk
  wellness_factor_category_name varchar
  wellness_factor_category_position numeric // numeric(20, 10)
  wellness_factor_category_created_time timestamptz
  wellness_factor_category_updated_time timestamptz?
  wellness_factor_category_deleted_time timestamptz?

  // unique(name)
}

wellness_factor [color: blue] {
  wellness_factor_id varchar pk
  wellness_factor_wellness_factor_category_id varchar fk
  wellness_factor_name varchar
  wellness_factor_position numeric // numeric(20, 10)
  wellness_factor_created_time timestamptz
  wellness_factor_updated_time timestamptz?
  wellness_factor_deleted_time timestamptz?

  // unique(name)
}

wellness_factor_category.id < wellness_factor.wellness_factor_category_id

check_in [color: blue] {
  check_in_id varchar pk
  check_in_user_id varchar fk
  check_in_mood_rating int
  check_in_sleep_quality_rating int?
  check_in_sleep_time interval?
  check_in_check_in_time timestamptz
  check_in_created_time timestamptz
  check_in_updated_time timestamptz?
}

user.id < check_in.user_id

check_in_wellness_mood [color: green] {
  check_in_wellness_mood_id varchar pk
  check_in_wellness_mood_check_in_id varchar fk
  check_in_wellness_mood_wellness_mood_id varchar fk

  // unique(check_in_id, wellness_mood_id)
}

check_in.id < check_in_wellness_mood.check_in_id
wellness_mood.id < check_in_wellness_mood.wellness_mood_id

check_in_wellness_symptom [color: green] {
  check_in_wellness_symptom_id varchar pk
  check_in_wellness_symptom_check_in_id varchar fk
  check_in_wellness_symptom_wellness_symptom_id varchar fk

  // unique(check_in_id, wellness_symptom_id)
}

check_in.id < check_in_wellness_symptom.check_in_id
wellness_symptom.id < check_in_wellness_symptom.wellness_symptom_id

check_in_wellness_factor [color: green] {
  check_in_wellness_factor_id varchar pk
  check_in_wellness_factor_check_in_id varchar fk
  check_in_wellness_factor_wellness_factor_id varchar fk

  // unique(check_in_id, wellness_factor_id)
}

check_in.id < check_in_wellness_factor.check_in_id
wellness_factor.id < check_in_wellness_factor.wellness_factor_id

check_in_health_measurement [color: blue] {
  check_in_health_measurement_id varchar pk
  check_in_health_measurement_check_in_id varchar fk
  check_in_health_measurement_heart_rate int?
  check_in_health_measurement_step_count int?
  check_in_health_measurement_weight double?
}

check_in.id - check_in_health_measurement.check_in_id

counselor_user [color: blue] {
  counselor_user_id varchar pk
  counselor_user_counselor_id varchar fk
  counselor_user_user_id varchar fk
  counselor_user_note text?
  counselor_user_created_time timestamptz
  counselor_user_updated_time timestamptz?
  counselor_user_released_tine timestamptz?
}

user.id < counselor_user.counselor_id
user.id < counselor_user.user_id

role_application [color: blue] {
  role_application_id varchar pk
  role_application_applicant_id  varchar fk
  role_application_applied_role_id varchar fk
  role_application_status // pending, approved, rejected
  role_application_description text?
  role_application_created_time timestamptz
  role_application_processed_time timestamptz?
  role_application_processed_by varchar? fk
  role_application_updated_time timestamptz?
  role_application_deleted_time timestamptz?
}

user.id < role_application.applicant_id
role.id < role_application.applied_role_id
user.id < role_application.processed_by

role_attachment [color: green] {
  role_attachment_id varchar pk
  role_attachment_role_application_id varchar fk
  role_attachment_attachment_id varchar fk

  // unique(role_application_id, attachment_id)
}

role_application.id < role_attachment.role_application_id
attachment.id < role_attachment.attachment_id

role_change_action [color: blue] {
  role_change_action_id varchar pk
  role_change_action_target_user_id varchar fk
  role_change_action_old_role_id varchar fk
  role_change_action_new_role_id varchar fk
  role_change_action_type varchar // promotion, demotion
  role_change_action_processed_by varchar fk
  role_change_action_role_application_id varchar? fk
  role_change_action_created_time timestamptz
  role_change_action_updated_time timestamptz?
  role_change_action_deleted_time timestamptz

  // check(old_role_id != new_role_id)
}

user.id < role_change_action.target_user_id
role.id < role_change_action.old_role_id
role.id < role_change_action.new_role_id
user.id < role_change_action.processed_by
role_application.id < role_change_action.role_application_id

achievement_category [color: blue] {
  achievement_category_id varchar pk
  achievement_category_name varchar 
  achievement_category_created_time timestamptz
  achievement_category_updated_time timestamptz?
  achievement_category_deleted_time timestamptz?

  // unique(name)
}

achievement [color: blue] {
  achievement_id varchar pk
  achievement_achievement_category_id varchar fk
  achievement_title varchar
  achievement_description text
  achievement_criteria jsonb
  achievement_created_time timestamptz
  achievement_updated_time timestamptz?
  achievement_deleted_time timestamptz?
} 

achievement_category.id < achievement.achievement_category_id

user_achievement [color: green] {
  user_achievement_id varchar pk
  user_achievement_user_id varchar fk
  user_achievement_achievement_id varchar fk
  user_achievement_is_visible boolean
  user_achievement_awarded_time timestamptz
  user_achievement_updated_time timestamptz?

  // unique(user_id, achievement_id)
} 

user.id < user_achievement.user_id
achievement.id < user_achievement.achievement_id

notification_category [color: blue] {
  notification_category_id varchar pk
  notification_category_name varchar // discussion, friend, conversation, system
  notification_category_created_time timestamptz
  notification_category_updated_time timestamptz?
  notification_category_deleted_time timestamptz?

  // unique(name)
}

notification_type [color: blue] {
  notification_type_id varchar pk
  notification_type_notification_category_id varchar fk
  notification_type_name varchar
  notification_type_payload_fields jsonb
  notification_type_created_time timestamptz
  notification_type_updated_time timestamptz?
  notification_type_deleted_time timestamptz?
  
  // unique(name)
}

notification_category.id < notification_type.notification_category_id

notification [color: blue] {
  notification_id varchar pk
  notification_notification_type_id varchar fk
  notification_recipient_id varchar fk
  notification_title text
  notification_body text
  notification_payload jsonb
  notification_seen_time timestamptz?
  notification_read_time timestamptz?
  notification_created_time timestamptz
}

notification_type.id < notification.notification_type_id
user.id < notification.recipient_id